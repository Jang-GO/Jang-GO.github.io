---
layout: post
title:  "모던 자바 인 액션 6장"
date:   2024-07-23 16:28:06 +0900
categories: 모던-자바-인-액션
excerpt_separator: <!--more-->
toc : ture
---
모던 자바 인 액션 6장 : 스트림으로 데이터 수집
<!--more-->

이번장에서는 최종연산 `collect`로 다양한 요소 누적 방식을 인수로 받아서 최종 결과를 도출하는 방식을 알아본다.<br>
다음은 collect와 컬렉터로 구현할 수 있는 질의 예제이다.
* 통화별로 트랜잭션을 그룹화한 다음에 해당 통화로 일어난 모든 트랜잭션 합계를 계산하시오<br>
(Map<Currency, Integer> 반환)
* 트랜잭션을 비싼 트랜잭션과 저렴한 트랜잭션 두 그룹으로 분류하시오<br>
(Map<Boolean, List<Transaction>> 반환)
* 트랜잭션을 도시 등 다수준으로 그룹화하시오. 그리고 각 트랜잭션이 비싼지 저렴한지 구분하시오<br>
(Map<String, Map<Boolean, List<Transaction>>> 반환)

<br>
## 6.1 컬렉터란 무엇인가?

#### 6.1.1 고급 리듀싱 기능을 수행하는 컬렉터
스트림에 collect를 호출하면 스트림의 요소에(컬렉터로 파라미터화된) 리듀싱 연산이 수행된다.<br>
collect에서는 리듀싱 연산을 이용해서 스트림의 각 요소를 방문하면서 컬렉터가 작업을 처리한다.<br>
![컬렉터](/assets/모던자바인액션/20240723_collector.png)

* Collector 인터페이스의 메서드를 어떻게 구현하느냐에 따라 어떤 리듀싱 연산을 수행할지 결정된다.
* Collectors 유틸리티 클래스는 자주 사용하는 컬렉터 인스턴스를 손쉽게 생성할 수 있는 정적 팩터리 메서드를 제공한다.

#### 6.1.2 미리 정의된 컬렉터
6장에서는 groupingBy같이 Collectors 클래스에서 제공하는 팩토리 메서드의 기능을 설명한다.<br>
Collectors에서 제공하는 메서드의 기능은 크게 세 가지로 구분할 수 있다.
* 스트림 요소를 하나의 값으로 리듀스하고 요약
* 요소 그룹화
* 요소 분할

다음절부터 하나씩 알아보자.

## 6.2 리듀싱과 요약
컬렉터로 스트림의 항목을 컬렉션 혹은 정수 등 다양한 형식으로 결과를 도출할 수 있다. <br>

아래는 예제 코드이다
```
long howManyDishes = menu.stream().collect(Collectors.counting());

// 불필요한 과정 생략 가능
long howManyDishes - menu.stream().count();
```

#### 6.2.1 스트림값에서 최댓값과 최솟값 검색
* Collectors.maxBy, Collectors.minBy를 제공한다.
* 두 컬렉터는 요소를 비교할 때 사용할 Comparator를 인수로 받는다.

```
Comparator<Dish> dishCaloriesComparator = Comparator.compareingInt(Dish::getCalories);

Optional<Dish> mostCalorieDish = menu.stream()
                                    .collect(maxBy(dishCaloriesComparator));
```
* menu가 비어있을 수 있으므로 Optional로 받는다.
* 최댓값 뿐만 아니라 객체의 숫자 필드의 합계나 평균 등을 반환하는 연산에도 리듀싱 기능이 자주 사용된다. 이러한 연산을 <b>요약</b> 연산이라 부른다.

#### 6.2.2 요약 연산
> `Collectors`를 static import 했다고 가정<br>

* 합계 구하기 : `summingInt`, `summingLong`, `summingDouble`
```
int totalCalories = menu.stream().collect(summingInt(Dish::getCalories));
```
* 평균값 계산 : `averagingInt`,`averagingLong`,`averagingDouble`
```
double avgCalories = menu.stream().collect(averagingInt(Dish::getCalories))
```
* 두 개 이상의 연산을 한번에 수행 : summarizingInt

```
IntSummaryStatistics collected = ch4.menu.stream().collect(summarizingInt(Dish::getCalories));

//출력
IntSummaryStatistics{count=9, sum=4200, min=120, average=466.666667, max=800}
```

#### 6.2.3 문자열 연결
